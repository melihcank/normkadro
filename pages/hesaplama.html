<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest" href="../manifest.json">
    <title>Hesaplama - Norm Kadro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i data-lucide="calculator"></i>
                    <span>Norm Kadro</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Ana Men√º</div>
                    <a href="../index.html" class="nav-link">
                        <i data-lucide="layout-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Organizasyon</div>
                    <a href="personel.html" class="nav-link">
                        <i data-lucide="users"></i>
                        <span>Personel</span>
                    </a>
                    <a href="organizasyon.html" class="nav-link">
                        <i data-lucide="git-branch"></i>
                        <span>Org. ≈ûemasƒ±</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Veri Giri≈üi</div>
                    <a href="is-analizi.html" class="nav-link">
                        <i data-lucide="briefcase"></i>
                        <span>Pozisyonlar</span>
                    </a>
                    <a href="gorevler.html" class="nav-link">
                        <i data-lucide="list-checks"></i>
                        <span>G√∂revler</span>
                    </a>
                    <a href="is-yuku.html" class="nav-link">
                        <i data-lucide="bar-chart-3"></i>
                        <span>ƒ∞≈ü Y√ºk√º</span>
                    </a>
                    <a href="standart-zaman.html" class="nav-link">
                        <i data-lucide="clock"></i>
                        <span>Standart Zaman</span>
                    </a>
                                    <a href="zaman-etudu.html" class="nav-link">
                        <i data-lucide="timer"></i>
                        <span>Zaman Et¸d¸</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Raporlama</div>
                    <a href="hesaplama.html" class="nav-link active">
                        <i data-lucide="file-text"></i>
                        <span>Hesaplama</span>
                    </a>
                    </div>
            </nav>

            <div class="sidebar-footer">
                <button class="theme-toggle" onclick="toggleTheme()" title="Tema Deƒüi≈ütir"></button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i data-lucide="menu"></i>
                </button>
                <h1 class="header-title">Norm Kadro Hesaplama</h1>
                <div class="header-actions"></div>
            </header>

            <div class="page-content">
                <!-- Parametre Kartƒ± -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i data-lucide="settings"></i>
                            Hesaplama Parametreleri
                        </h2>
                    </div>
                    <div class="card-body">
                        <!-- Hesaplama Modu Se√ßimi -->
                        <div class="form-group mb-4">
                            <label class="form-label">Hesaplama Modu</label>
                            <div class="flex gap-4">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="hesaplamaModu" value="genel" checked
                                        onchange="toggleHesaplamaModu()">
                                    <span>Genel Hesaplama</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="hesaplamaModu" value="pozisyon"
                                        onchange="toggleHesaplamaModu()">
                                    <span>Pozisyon Bazlƒ± Hesaplama</span>
                                </label>
                            </div>
                            <div class="form-hint">Pozisyon bazlƒ± hesaplamada her pozisyon i√ßin ayrƒ± √ßalƒ±≈üma saati ve
                                verimlilik belirleyebilirsiniz</div>
                        </div>

                        <!-- Daƒüƒ±tƒ±m Y√∂ntemi Se√ßimi -->
                        <div class="form-group mb-4">
                            <label class="form-label">
                                <i data-lucide="git-fork"
                                    style="width: 16px; height: 16px; display: inline-block; vertical-align: middle;"></i>
                                Payla≈üƒ±mlƒ± G√∂rev Daƒüƒ±tƒ±mƒ±
                            </label>
                            <div class="flex gap-4">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="dagitimYontemi" value="oransal" checked>
                                    <span>Oransal Daƒüƒ±tƒ±m</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="dagitimYontemi" value="optimize">
                                    <span>Kademeli Daƒüƒ±tƒ±m (√ñncelik Bazlƒ±)</span>
                                </label>
                            </div>
                            <div class="form-hint" style="margin-top: 6px;">
                                <strong>Oransal:</strong> Payla≈üƒ±mlƒ± g√∂revler, yapan ki≈üi sayƒ±sƒ±na g√∂re
                                orantƒ±lƒ± daƒüƒ±tƒ±lƒ±r<br>
                                <strong>Kademeli:</strong> G√∂rev matrisindeki √∂nceliƒüe g√∂re daƒüƒ±tƒ±lƒ±r (‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê √∂nce,
                                kapasite yetmezse ‚≠ê‚≠ê‚≠ê‚≠ê alƒ±r...)
                            </div>
                        </div>

                        <!-- Genel Parametreler -->
                        <div id="genelParametreler">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Aylƒ±k √áalƒ±≈üma Saati</label>
                                    <input type="number" class="form-input" id="aylikCalisma" value="160" min="1">
                                    <div class="form-hint">Bir √ßalƒ±≈üanƒ±n aylƒ±k toplam √ßalƒ±≈üma saati</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Verimlilik Katsayƒ±sƒ±</label>
                                    <input type="number" class="form-input" id="verimlilik" value="0.85" min="0.1"
                                        max="1" step="0.05">
                                    <div class="form-hint">0-1 arasƒ± (√∂rn: 0.85 = %85 verimlilik)</div>
                                </div>
                            </div>

                            <!-- D√∂nem Se√ßimi -->
                            <div class="form-group mt-4"
                                style="padding-top: 1rem; border-top: 1px solid var(--border-color);">
                                <label class="form-label">
                                    <i data-lucide="calendar"
                                        style="width: 16px; height: 16px; display: inline-block; vertical-align: middle;"></i>
                                    D√∂nem Se√ßimi
                                </label>
                                <div class="flex gap-4 flex-wrap">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="donemSecimi" value="yillik" checked
                                            onchange="toggleDonemAySecimi()">
                                        <span>Yƒ±llƒ±k Ortalama</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="donemSecimi" value="pik"
                                            onchange="toggleDonemAySecimi()">
                                        <span>Pik D√∂nem (en yoƒüun 3 ay)</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="donemSecimi" value="belirli"
                                            onchange="toggleDonemAySecimi()">
                                        <span>Belirli Ay</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="donemSecimi" value="dusuk"
                                            onchange="toggleDonemAySecimi()">
                                        <span>D√º≈ü√ºk D√∂nem (en sakin 3 ay)</span>
                                    </label>
                                </div>
                                <div id="aySecimi" style="display: none; margin-top: 0.5rem;">
                                    <select class="form-select" id="secilenAy" style="width: 200px;">
                                        <option value="1">Ocak</option>
                                        <option value="2">≈ûubat</option>
                                        <option value="3">Mart</option>
                                        <option value="4">Nisan</option>
                                        <option value="5">Mayƒ±s</option>
                                        <option value="6">Haziran</option>
                                        <option value="7">Temmuz</option>
                                        <option value="8">Aƒüustos</option>
                                        <option value="9">Eyl√ºl</option>
                                        <option value="10">Ekim</option>
                                        <option value="11">Kasƒ±m</option>
                                        <option value="12">Aralƒ±k</option>
                                    </select>
                                </div>
                                <div class="form-hint">Mevsimsel i≈ü y√ºk√º tanƒ±mlanmƒ±≈ü g√∂revler i√ßin d√∂nem bazlƒ± hesaplama
                                    yapƒ±lƒ±r</div>
                            </div>

                            <!-- √ñncelik Filtresi -->
                            <div class="form-group mt-4"
                                style="padding-top: 1rem; border-top: 1px solid var(--border-color);">
                                <label class="form-label">
                                    <i data-lucide="star"
                                        style="width: 16px; height: 16px; display: inline-block; vertical-align: middle;"></i>
                                    √ñncelik Filtresi
                                </label>
                                <div class="flex gap-4 flex-wrap">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" name="oncelikFiltre" value="5" checked>
                                        <span class="priority-badge priority-5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Kritik</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" name="oncelikFiltre" value="4" checked>
                                        <span class="priority-badge priority-4">‚≠ê‚≠ê‚≠ê‚≠ê Y√ºksek</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" name="oncelikFiltre" value="3" checked>
                                        <span class="priority-badge priority-3">‚≠ê‚≠ê‚≠ê Normal</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" name="oncelikFiltre" value="2">
                                        <span class="priority-badge priority-2">‚≠ê‚≠ê D√º≈ü√ºk</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" name="oncelikFiltre" value="1">
                                        <span class="priority-badge priority-1">‚≠ê Opsiyonel</span>
                                    </label>
                                </div>
                                <div class="form-hint">üí° Minimum kadro i√ßin sadece Kritik + Y√ºksek se√ßin</div>
                            </div>

                            <div class="mt-4">
                                <button class="btn btn-primary btn-lg" id="hesaplaBtn">
                                    <i data-lucide="calculator"></i>
                                    Hesapla
                                </button>
                            </div>
                        </div>

                        <!-- Pozisyon Bazlƒ± Parametreler -->
                        <div id="pozisyonParametreler" class="hidden">
                            <div class="table-container mb-4" style="max-height: 300px; overflow-y: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Pozisyon</th>
                                            <th>Departman</th>
                                            <th style="width: 140px;">Aylƒ±k √áalƒ±≈üma Saati</th>
                                            <th style="width: 140px;">Verimlilik</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pozisyonParametreTable"></tbody>
                                </table>
                            </div>
                            <button class="btn btn-primary btn-lg" id="hesaplaBtnPozisyon">
                                <i data-lucide="calculator"></i>
                                Pozisyon Bazlƒ± Hesapla
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sonu√ß Alanƒ± -->
                <div id="sonucAlani" class="hidden">
                    <!-- √ñzet -->
                    <div class="report-grid mb-4">
                        <div class="report-summary">
                            <h3>Toplam Mevcut Personel</h3>
                            <div class="value" id="toplamMevcut">0</div>
                        </div>
                        <div class="report-summary" style="background: linear-gradient(135deg, #10b981, #059669)">
                            <h3>Toplam Gerekli Personel</h3>
                            <div class="value" id="toplamGerekli">0</div>
                        </div>
                        <div class="report-summary" style="background: linear-gradient(135deg, #f59e0b, #d97706)">
                            <h3>Fark</h3>
                            <div class="value" id="toplamFark">0</div>
                        </div>
                        <div class="report-summary" style="background: linear-gradient(135deg, #ef4444, #dc2626)">
                            <h3>Mesai ƒ∞htiyacƒ±</h3>
                            <div class="value" id="toplamMesai">0 saat</div>
                        </div>
                    </div>

                    <!-- Rapor Tablosu -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i data-lucide="table"></i>
                                Norm Kadro Raporu
                            </h2>
                            <div class="flex gap-2">
                                <button class="btn btn-success btn-sm" onclick="exportOzetRapor()">
                                    <i data-lucide="download"></i>
                                    √ñzet Rapor
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="exportDetayRapor()">
                                    <i data-lucide="file-spreadsheet"></i>
                                    Detay Rapor
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Pozisyon</th>
                                            <th>Departman</th>
                                            <th class="text-center">Mevcut</th>
                                            <th class="text-center">Gerekli</th>
                                            <th class="text-center">Fark</th>
                                            <th class="text-center">Mesai ƒ∞htiyacƒ±</th>
                                            <th>Durum</th>
                                        </tr>
                                    </thead>
                                    <tbody id="raporTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../libs/sql-wasm.js"></script>
    <script src="../libs/xlsx.full.min.js"></script>
    <script src="../libs/lucide.min.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/db.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/hesaplama.js"></script>
</body>

</html>


